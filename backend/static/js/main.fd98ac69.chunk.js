(this["webpackJsonpreact-redux-registration-login-example"]=this["webpackJsonpreact-redux-registration-login-example"]||[]).push([[0],{52:function(e,t,r){"use strict";r.r(t);var a=r(0),n=r.n(a),s=r(29),o=r(7),A=r(36),i=JSON.parse(localStorage.getItem("users"))||[];var l=r(6),c=Object(l.a)(),u=r(13),m=r(32),h=r.n(m),g=r(33),d="ALERT_SUCCESS",f="ALERT_ERROR",p="ALERT_CLEAR",E="USERS_REGISTER_REQUEST",b="USERS_REGISTER_SUCCESS",v="USERS_REGISTER_FAILURE",C="USERS_LOGIN_REQUEST",S="USERS_LOGIN_SUCCESS",w="USERS_LOGIN_FAILURE",N="USERS_LOGOUT",O="USERS_GETALL_REQUEST",I="USERS_GETALL_SUCCESS",y="USERS_GETALL_FAILURE",j=JSON.parse(localStorage.getItem("user")),Q=j?{loggedIn:!0,user:j}:{};var k=Object(u.c)({authentication:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case C:return{loggingIn:!0,user:t.user};case S:return{loggedIn:!0,user:t.user};case w:case N:return{};default:return e}},registration:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case E:return{registering:!0};case b:case v:return{};default:return e}},users:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return{loading:!0};case I:return{items:t.users};case y:return{error:t.error};default:return e}},alert:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case d:return{type:"alert-success",message:t.message};case f:return{type:"alert-danger",message:t.message};case p:return{};default:return e}}}),R=Object(g.createLogger)(),G=Object(u.d)(k,Object(u.a)(h.a,R));function U(){var e=JSON.parse(localStorage.getItem("user"));return e&&e.token?{Authorization:"Bearer "+e.token}:{}}var M=r(8),J=r(9),B=r(11),D=r(10),L=r(5),T={success:function(e){return{type:d,message:e}},error:function(e){return{type:f,message:e}},clear:function(){return{type:p}}};var K=r(15),Y={login:function(e,t){var r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})};return fetch("/users/authenticate",r).then(F).then((function(e){return localStorage.setItem("user",JSON.stringify(e)),e}))},logout:x,register:function(e){var t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return fetch("/users/register",t).then(F)},getAll:function(){var e={method:"GET",headers:U()};return fetch("/users",e).then(F)},getById:function(e){var t={method:"GET",headers:U()};return fetch("/users/".concat(e),t).then(F)},update:function(e){var t={method:"PUT",headers:Object(K.a)(Object(K.a)({},U()),{},{"Content-Type":"application/json"}),body:JSON.stringify(e)};return fetch("/users/".concat(e.id),t).then(F)}};function x(){localStorage.removeItem("user")}function F(e){return e.text().then((function(t){var r=t&&JSON.parse(t);if(!e.ok){401===e.status&&x();var a=r&&r.message||e.statusText;return Promise.reject(a)}return r}))}var H={login:function(e,t){return function(r){r({type:C,user:{username:e}}),Y.login(e,t).then((function(e){r(function(e){return{type:S,user:e}}(e)),c.push("/")}),(function(e){r(function(e){return{type:w,error:e}}(e)),r(T.error(e))}))}},logout:function(){return Y.logout(),{type:N}},register:function(e){return function(t){t(function(e){return{type:E,user:e}}(e)),Y.register(e).then((function(e){t(function(e){return{type:b,user:e}}()),c.push("/login"),t(T.success("Registration successful"))}),(function(e){t(function(e){return{type:v,error:e}}(e)),t(T.error(e))}))}},getAll:function(){return function(e){e({type:O}),Y.getAll().then((function(t){return e(function(e){return{type:I,users:e}}(t))}),(function(t){return e(function(e){return{type:y,error:e}}(t))}))}}};var P=r(37),W=function(e){var t=e.component,r=Object(P.a)(e,["component"]);return n.a.createElement(L.c,Object.assign({},r,{render:function(e){return localStorage.getItem("user")?n.a.createElement(t,e):n.a.createElement(L.b,{to:{pathname:"/login",state:{from:e.location}}})}}))},_=function(e){Object(B.a)(r,e);var t=Object(D.a)(r);function r(){return Object(M.a)(this,r),t.apply(this,arguments)}return Object(J.a)(r,[{key:"componentDidMount",value:function(){this.props.getUsers()}},{key:"render",value:function(){var e=this.props,t=e.user;e.users;return n.a.createElement("div",{className:"col-md-6 col-md-offset-3"},n.a.createElement("h1",null,"Hi ",t.firstName,"!"),n.a.createElement("p",null,"You're logged in!!"),n.a.createElement("p",null,n.a.createElement(L.a,{to:"/login"},n.a.createElement("button",{className:"btn btn-primary"},"Logout"))))}}]),r}(n.a.Component);var z={getUsers:H.getAll},V=Object(o.b)((function(e){var t=e.users;return{user:e.authentication.user,users:t}}),z)(_),Z=r(14),q=r(12),X=function(e){Object(B.a)(r,e);var t=Object(D.a)(r);function r(e){var a;return Object(M.a)(this,r),(a=t.call(this,e)).props.logout(),a.state={username:"",password:"",submitted:!1},a.handleChange=a.handleChange.bind(Object(q.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(q.a)(a)),a}return Object(J.a)(r,[{key:"handleChange",value:function(e){var t=e.target,r=t.name,a=t.value;this.setState(Object(Z.a)({},r,a))}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.setState({submitted:!0});var t=this.state,r=t.username,a=t.password;r&&a&&this.props.login(r,a)}},{key:"render",value:function(){var e=this.props.loggingIn,t=this.state,r=t.username,a=t.password,s=t.submitted;return n.a.createElement("div",{className:"col-md-6 col-md-offset-3"},n.a.createElement("h2",null,"Login"),n.a.createElement("form",{name:"form",onSubmit:this.handleSubmit},n.a.createElement("div",{className:"form-group"+(s&&!r?" has-error":"")},n.a.createElement("label",{htmlFor:"username"},"Username"),n.a.createElement("input",{type:"text",className:"form-control",name:"username",value:r,onChange:this.handleChange}),s&&!r&&n.a.createElement("div",{className:"help-block"},"Username is required")),n.a.createElement("div",{className:"form-group"+(s&&!a?" has-error":"")},n.a.createElement("label",{htmlFor:"password"},"Password"),n.a.createElement("input",{type:"password",className:"form-control",name:"password",value:a,onChange:this.handleChange}),s&&!a&&n.a.createElement("div",{className:"help-block"},"Password is required")),n.a.createElement("div",{className:"form-group"},n.a.createElement("button",{className:"btn btn-primary"},"Login"),e&&n.a.createElement("img",{src:"data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="}),n.a.createElement(L.a,{to:"/register",className:"btn btn-link"},"Register"))))}}]),r}(n.a.Component);var $={login:H.login,logout:H.logout},ee=Object(o.b)((function(e){return{loggingIn:e.authentication.loggingIn}}),$)(X),te=function(e){Object(B.a)(r,e);var t=Object(D.a)(r);function r(e){var a;return Object(M.a)(this,r),(a=t.call(this,e)).state={user:{firstName:"",lastName:"",username:"",password:""},submitted:!1},a.handleChange=a.handleChange.bind(Object(q.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(q.a)(a)),a}return Object(J.a)(r,[{key:"handleChange",value:function(e){var t=e.target,r=t.name,a=t.value,n=this.state.user;this.setState({user:Object(K.a)(Object(K.a)({},n),{},Object(Z.a)({},r,a))})}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.setState({submitted:!0});var t=this.state.user;t.firstName&&t.lastName&&t.username&&t.password&&this.props.register(t)}},{key:"render",value:function(){var e=this.props.registering,t=this.state,r=t.user,a=t.submitted;return n.a.createElement("div",{className:"col-md-6 col-md-offset-3"},n.a.createElement("h2",null,"Register"),n.a.createElement("form",{name:"form",onSubmit:this.handleSubmit},n.a.createElement("div",{className:"form-group"+(a&&!r.firstName?" has-error":"")},n.a.createElement("label",{htmlFor:"firstName"},"First Name"),n.a.createElement("input",{type:"text",className:"form-control",name:"firstName",value:r.firstName,onChange:this.handleChange}),a&&!r.firstName&&n.a.createElement("div",{className:"help-block"},"First Name is required")),n.a.createElement("div",{className:"form-group"+(a&&!r.lastName?" has-error":"")},n.a.createElement("label",{htmlFor:"lastName"},"Last Name"),n.a.createElement("input",{type:"text",className:"form-control",name:"lastName",value:r.lastName,onChange:this.handleChange}),a&&!r.lastName&&n.a.createElement("div",{className:"help-block"},"Last Name is required")),n.a.createElement("div",{className:"form-group"+(a&&!r.username?" has-error":"")},n.a.createElement("label",{htmlFor:"username"},"Username"),n.a.createElement("input",{type:"text",className:"form-control",name:"username",value:r.username,onChange:this.handleChange}),a&&!r.username&&n.a.createElement("div",{className:"help-block"},"Username is required")),n.a.createElement("div",{className:"form-group"+(a&&!r.password?" has-error":"")},n.a.createElement("label",{htmlFor:"password"},"Password"),n.a.createElement("input",{type:"password",className:"form-control",name:"password",value:r.password,onChange:this.handleChange}),a&&!r.password&&n.a.createElement("div",{className:"help-block"},"Password is required")),n.a.createElement("div",{className:"form-group"},n.a.createElement("button",{className:"btn btn-primary"},"Register"),e&&n.a.createElement("img",{src:"data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="}),n.a.createElement(L.a,{to:"/login",className:"btn btn-link"},"Cancel"))))}}]),r}(n.a.Component);var re={register:H.register},ae=Object(o.b)((function(e){return{registering:e.registration.registering}}),re)(te),ne=function(e){Object(B.a)(r,e);var t=Object(D.a)(r);function r(e){var a;return Object(M.a)(this,r),a=t.call(this,e),c.listen((function(e,t){a.props.clearAlerts()})),a}return Object(J.a)(r,[{key:"render",value:function(){var e=this.props.alert;return n.a.createElement("div",{className:"jumbotron"},n.a.createElement("div",{className:"container"},n.a.createElement("div",{className:"col-sm-8 col-sm-offset-2"},e.message&&n.a.createElement("div",{className:"alert ".concat(e.type)},e.message),n.a.createElement(L.d,{history:c},n.a.createElement(L.e,null,n.a.createElement(W,{exact:!0,path:"/",component:V}),n.a.createElement(L.c,{path:"/login",component:ee}),n.a.createElement(L.c,{path:"/register",component:ae}),n.a.createElement(L.b,{from:"*",to:"/"}))))))}}]),r}(n.a.Component);var se={clearAlerts:T.clear},oe=Object(o.b)((function(e){return{alert:e.alert}}),se)(ne);!function(){var e=window.fetch;window.fetch=function(t,r){return new Promise((function(a,n){setTimeout((function(){if(t.endsWith("/users/authenticate")&&"POST"===r.method){var s=JSON.parse(r.body),o=i.filter((function(e){return e.username===s.username&&e.password===s.password}));if(o.length){var l=o[0],c={id:l.id,username:l.username,firstName:l.firstName,lastName:l.lastName,token:"fake-jwt-token"};a({ok:!0,text:function(){return Promise.resolve(JSON.stringify(c))}})}else n("Username or password is incorrect")}else if(t.endsWith("/users")&&"GET"===r.method)r.headers&&"Bearer fake-jwt-token"===r.headers.Authorization?a({ok:!0,text:function(){return Promise.resolve(JSON.stringify(i))}}):n("Unauthorised");else if(t.match(/\/users\/\d+$/)&&"GET"===r.method)if(r.headers&&"Bearer fake-jwt-token"===r.headers.Authorization){var u=t.split("/"),m=parseInt(u[u.length-1]),h=i.filter((function(e){return e.id===m})),g=h.length?h[0]:null;a({ok:!0,text:function(){return JSON.stringify(g)}})}else n("Unauthorised");else{if(t.endsWith("/users/register")&&"POST"===r.method){var d=JSON.parse(r.body);return i.filter((function(e){return e.username===d.username})).length?void n('Username "'+d.username+'" is already taken'):(d.id=i.length?Math.max.apply(Math,Object(A.a)(i.map((function(e){return e.id}))))+1:1,i.push(d),localStorage.setItem("users",JSON.stringify(i)),void a({ok:!0,text:function(){return Promise.resolve()}}))}e(t,r).then((function(e){return a(e)}))}}),500)}))}}(),Object(s.render)(n.a.createElement(o.a,{store:G},n.a.createElement(oe,null)),document.getElementById("app"))}},[[52,1,2]]]);
//# sourceMappingURL=main.fd98ac69.chunk.js.map